{% extends "document.njk" %}

{% block content %}
  {{ summary({
    title: "Application",
    actions: [{
      text: "Edit",
      href: "/settings/application?referrer=/settings"
    }],
    rows: [{
      key: {
        text: "Name"
      },
      value: {
        text: application.name or "Not set"
      }
    }, {
      key: {
        text: "Language"
      },
      value: {
        text: application.locale | language or "Not set"
      }
    }, {
      key: {
        text: "Theme colour"
      },
      value: {
        text: "<span style=\"color:" + application.themeColor + "\" aria-hidden\"true\">‚óè</span> " + application.themeColor
      }
    }]
  }) }}

  {%- set bookmarklet %}
    {% set bookmarkletFunction -%}
      (function() {
        var title = document.getElementsByTagName('title')[0].innerHTML;
        name = encodeURIComponent(title);

        var selection = '';
        if (window.getSelection) {
          selection = window.getSelection().toString();
        } else if (document.selection && document.selection.type != 'Control') {
          selection = document.selection.createRange().text;
        }
        content = encodeURIComponent(selection);

        new_window=window.open(
          '{{ application.url }}/share/bookmarklet?name='+name+'&content='+content+'&url='+encodeURIComponent(document.location.href),
          'Sharer',
          'resizable,scrollbars,status=0,toolbar=0,menubar=0,titlebar=0,width=560,height=720,location=0'
        );
      })();
    {%- endset %}
    {% set bookmarkletHref = "javascript:" + bookmarkletFunction | replace("  ", "") | replace("\n", "") | replace("&", "&amp;") | trim %}
    {{ bookmarklet({
      href: bookmarkletHref,
      text: "Share page"
    }) }}
  {%- endset %}

  {{ summary({
    title: "Publication",
    actions: [{
      text: "Edit",
      href: "/settings/publication?referrer=/settings"
    }],
    rows: [{
      key: {
        text: "Web address"
      },
      value: {
        text: publication.me or "Not set"
      }
    }, {
      key: {
        text: "Content host"
      },
      value: {
        text: publication.hostId or "Not set"
      }
    }, {
      key: {
        text: "Default configuration"
      },
      value: {
        text: publication.defaultConfigType | capitalize or "Not set"
      }
    }, {
      key: {
        text: "Custom configuration URL"
      },
      value: {
        text: publication.customConfigUrl or "Not set"
      }
    }, {
      key: {
        text: "Bookmarklet"
      },
      value: {
        text: "Drag this link to your bookmarks bar: " + bookmarklet
      }
    }]
  }) }}

  {{ summary({
    title: "GitHub",
    actions: [{
      href: "/settings/github?referrer=/settings",
      text: "Edit"
    }],
    rows: [{
      key: {
        text: "Username"
      },
      value: {
        text: github.user or "Not set"
      }
    }, {
      key: {
        text: "Repository name"
      },
      value: {
        text: github.repo or "Not set"
      }
    }, {
      key: {
        text: "Branch name"
      },
      value: {
        text: github.branch or "Not set"
      }
    }, {
      key: {
        text: "Personal access token"
      },
      value: {
        text: "<code>" + github.token + "</code>" or "Not set"
      }
    }]
  }) if publication.hostId == "github" }}

  {{ summary({
    title: "GitLab",
    actions: [{
      href: "/settings/gitlab?referrer=/settings",
      text: "Edit"
    }],
    rows: [{
      key: {
        text: "Instance"
      },
      value: {
        text: gitlab.instance or "Not set"
      }
    }, {
      key: {
        text: "Username"
      },
      value: {
        text: gitlab.user or "Not set"
      }
    }, {
      key: {
        text: "Project name"
      },
      value: {
        text: gitlab.repo or "Not set"
      }
    }, {
      key: {
        text: "Branch name"
      },
      value: {
        text: gitlab.branch or "Not set"
      }
    }, {
      key: {
        text: "Personal access token"
      },
      value: {
        text: "<code>" + gitlab.token + "</code>" or "Not set"
      }
    }]
  }) if publication.hostId == "gitlab" }}
{% endblock %}